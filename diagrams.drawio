<mxfile host="app.diagrams.net" modified="2026-03-01T00:00:00.000Z" type="device">

  <diagram id="fig1" name="Figure 1 - System Architecture">
    <mxGraphModel dx="1422" dy="850" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="2" value="&lt;b&gt;STUDENT USER&lt;/b&gt;&lt;br&gt;(Browser / Mobile Web)" style="rounded=1;whiteSpace=wrap;html=1;arcSize=50;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="240" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="3" value="&lt;b&gt;Sign Up &amp; Verify&lt;/b&gt;&lt;br&gt;.edu email" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="120" y="140" width="180" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="4" value="&lt;b&gt;Log In&lt;/b&gt;&lt;br&gt;JWT Session" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="430" y="140" width="180" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="5" value="&lt;b&gt;Use App&lt;/b&gt;&lt;br&gt;Messages, Files, Groups" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="740" y="140" width="180" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="6" value="&lt;b&gt;SUPABASE AUTH (GoTrue)&lt;/b&gt;&lt;br&gt;Email/Password &amp;bull; JWT Tokens &amp;bull; Email Verification" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="250" y="280" width="380" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="7" value="&lt;b&gt;DATABASE&lt;/b&gt;&lt;br&gt;PostgreSQL&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;profiles, messages,&lt;br&gt;schools, keys&lt;/font&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="120" y="420" width="180" height="100" as="geometry"/>
        </mxCell>
        <mxCell id="8" value="&lt;b&gt;REALTIME&lt;/b&gt;&lt;br&gt;WebSocket&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;Message events,&lt;br&gt;Typing, Presence&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="430" y="420" width="180" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="9" value="&lt;b&gt;STORAGE&lt;/b&gt;&lt;br&gt;S3-Compatible&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;Encrypted file blobs&lt;/font&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="740" y="420" width="180" height="100" as="geometry"/>
        </mxCell>
        <mxCell id="10" value="ALL messages and files are encrypted&lt;br&gt;CLIENT-SIDE before reaching server&lt;br&gt;using NaCl Box (TweetNaCl.js)" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;size=15;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="350" y="580" width="300" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="2" target="3" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="2" target="4" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="2" target="5" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="3" target="6" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="4" target="6" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="6" target="7" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="6" target="8" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="6" target="9" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="e9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;dashed=1;" edge="1" source="5" target="9" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="fig2" name="Figure 2 - Use Case Diagram">
    <mxGraphModel dx="1422" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="900">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="boundary" value="CAMPUSCONNECT" style="shape=mxgraph.sysml.package;whiteSpace=wrap;html=1;labelX=120;align=left;verticalAlign=top;spacingTop=5;spacingLeft=10;fontSize=14;fontStyle=1;fillColor=none;strokeColor=#333333;dashed=0;overflow=hidden;" vertex="1" parent="1">
          <mxGeometry x="100" y="20" width="800" height="560" as="geometry"/>
        </mxCell>
        <mxCell id="grp1" value="&lt;b&gt;AUTHENTICATION&lt;/b&gt;" style="text;html=1;fontSize=12;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="60" width="160" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="uc1" value="Register&lt;br&gt;(.edu email)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="140" y="100" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc2" value="Log In / Log Out" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="140" y="180" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc3" value="Reset Password" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="140" y="260" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="grp2" value="&lt;b&gt;MESSAGING&lt;/b&gt;" style="text;html=1;fontSize=12;align=center;" vertex="1" parent="1">
          <mxGeometry x="420" y="60" width="160" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="uc4" value="Send Encrypted&lt;br&gt;Message" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="100" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc5" value="Create DM / Group" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="180" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc6" value="Share Encrypted File" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="260" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc7" value="Translate Message" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="340" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc8" value="View Read Receipts" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="420" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc9" value="@Mention User" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="500" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="grp3" value="&lt;b&gt;SETTINGS&lt;/b&gt;" style="text;html=1;fontSize=12;align=center;" vertex="1" parent="1">
          <mxGeometry x="700" y="60" width="160" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="uc10" value="Manage E2EE Keys" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="690" y="100" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc11" value="Update Profile" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="690" y="180" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc12" value="Set Language" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="690" y="260" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="uc13" value="Enable Notifications" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="690" y="340" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="student" value="Student" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="20" y="250" width="40" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="system" value="System" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fontSize=12;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="970" y="250" width="40" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="sys_uc1" value="Auto-Detect School" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="140" y="380" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="sys_uc2" value="Real-Time Delivery" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="140" y="460" width="150" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="sys_uc3" value="Generate E2EE&lt;br&gt;Keypair" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="690" y="440" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="sys_uc4" value="Send Notifications" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="690" y="520" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="se1" style="html=1;dashed=0;" edge="1" source="student" target="uc1" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="se2" style="html=1;dashed=0;" edge="1" source="student" target="uc2" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="se3" style="html=1;dashed=0;" edge="1" source="student" target="uc4" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="se4" style="html=1;dashed=0;" edge="1" source="student" target="uc5" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="se5" style="html=1;dashed=0;" edge="1" source="student" target="uc10" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="se6" style="html=1;dashed=0;" edge="1" source="system" target="sys_uc1" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="se7" style="html=1;dashed=0;" edge="1" source="system" target="sys_uc2" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="se8" style="html=1;dashed=0;" edge="1" source="system" target="sys_uc3" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="se9" style="html=1;dashed=0;" edge="1" source="system" target="sys_uc4" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="fig3" name="Figure 3 - Send Encrypted Message">
    <mxGraphModel dx="1422" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="1200">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="lane1" value="Student A (Sender)" style="swimlane;startSize=30;fontSize=13;fontStyle=1;fillColor=#fff2cc;strokeColor=#d6b656;horizontal=1;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="230" height="1100" as="geometry"/>
        </mxCell>
        <mxCell id="s1" value="Type message" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="lane1">
          <mxGeometry x="30" y="60" width="160" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="s2" value="Press SEND" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="lane1">
          <mxGeometry x="30" y="180" width="160" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="s10" value="See &quot;Read&quot;&lt;br&gt;receipt" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="lane1">
          <mxGeometry x="30" y="980" width="160" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="lane2" value="Encryption Engine" style="swimlane;startSize=30;fontSize=13;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;horizontal=1;" vertex="1" parent="1">
          <mxGeometry x="270" y="20" width="250" height="1100" as="geometry"/>
        </mxCell>
        <mxCell id="s3" value="Broadcast typing&lt;br&gt;indicator" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="lane2">
          <mxGeometry x="40" y="60" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="s4" value="Fetch recipient&amp;rsquo;s&lt;br&gt;public key" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="lane2">
          <mxGeometry x="40" y="240" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="s5" value="&lt;b&gt;ENCRYPT&lt;/b&gt;&lt;br&gt;NaCl Box:&lt;br&gt;A&amp;rsquo;s private key&lt;br&gt;+ B&amp;rsquo;s public key&lt;br&gt;&amp;rarr; ciphertext" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="lane2">
          <mxGeometry x="30" y="340" width="180" height="100" as="geometry"/>
        </mxCell>
        <mxCell id="s6" value="Encrypted JSON&lt;br&gt;{recipient, ciphertext, nonce}" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;dashed=1;" vertex="1" parent="lane2">
          <mxGeometry x="30" y="490" width="180" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="lane3" value="Supabase (Server)" style="swimlane;startSize=30;fontSize=13;fontStyle=1;fillColor=#d5e8d4;strokeColor=#82b366;horizontal=1;" vertex="1" parent="1">
          <mxGeometry x="540" y="20" width="250" height="1100" as="geometry"/>
        </mxCell>
        <mxCell id="s7" value="Store encrypted&lt;br&gt;message in DB&lt;br&gt;&lt;font style=&quot;font-size:9px;&quot;&gt;(Server CANNOT read it)&lt;/font&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="lane3">
          <mxGeometry x="40" y="480" width="170" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="s8" value="Realtime push&lt;br&gt;to recipient" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="lane3">
          <mxGeometry x="40" y="620" width="170" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="lane4" value="Student B (Recipient)" style="swimlane;startSize=30;fontSize=13;fontStyle=1;fillColor=#e1d5e7;strokeColor=#9673a6;horizontal=1;" vertex="1" parent="1">
          <mxGeometry x="810" y="20" width="250" height="1100" as="geometry"/>
        </mxCell>
        <mxCell id="s11" value="&amp;ldquo;Student A is typing...&amp;rdquo;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;dashed=1;" vertex="1" parent="lane4">
          <mxGeometry x="40" y="60" width="170" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="s9" value="&lt;b&gt;DECRYPT&lt;/b&gt;&lt;br&gt;NaCl Box:&lt;br&gt;B&amp;rsquo;s private key&lt;br&gt;+ A&amp;rsquo;s public key&lt;br&gt;&amp;rarr; plaintext" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="lane4">
          <mxGeometry x="40" y="700" width="170" height="100" as="geometry"/>
        </mxCell>
        <mxCell id="s12" value="Display in&lt;br&gt;chat bubble" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="lane4">
          <mxGeometry x="40" y="850" width="170" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="s13" value="Update last_read_at" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="lane4">
          <mxGeometry x="40" y="940" width="170" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="ea" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" source="s1" target="s3" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="eb" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" source="s3" target="s11" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ec" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;" edge="1" source="s1" target="s2" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ed" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;" edge="1" source="s2" target="s4" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ee" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;" edge="1" source="s4" target="s5" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ef" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;" edge="1" source="s5" target="s6" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="eg" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;" edge="1" source="s6" target="s7" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="eh" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;" edge="1" source="s7" target="s8" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ei" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;" edge="1" source="s8" target="s9" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ej" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;" edge="1" source="s9" target="s12" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ek" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;" edge="1" source="s12" target="s13" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="el" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;html=1;dashed=1;" edge="1" source="s13" target="s10" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="fig4" name="Figure 4 - User Registration">
    <mxGraphModel dx="1422" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="1000">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="start" value="Student opens&lt;br&gt;signup form" style="rounded=1;whiteSpace=wrap;html=1;arcSize=50;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="r1" value="Enter name, .edu email,&lt;br&gt;and password" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="110" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="r2" value="Email ends&lt;br&gt;with .edu?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="425" y="200" width="130" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="r_stop" value="STOP&lt;br&gt;&amp;ldquo;Use a .edu email&amp;rdquo;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="670" y="215" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="r3" value="Supabase Auth:&lt;br&gt;Create user in auth.users" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="330" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="r4" value="TRIGGER fires:&lt;br&gt;handle_new_user()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="420" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="r5" value="Extract domain&lt;br&gt;student.coloradotech.edu&lt;br&gt;&amp;rarr; strip prefix &amp;rarr; ctuonline.edu" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="380" y="510" width="220" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="r6" value="School&lt;br&gt;exists?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="435" y="610" width="110" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="r7" value="Create school&lt;br&gt;+ fetch logo" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="650" y="620" width="150" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="r8" value="Create profile&lt;br&gt;linked to school" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="730" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="r9" value="Send verification email" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="160" y="730" width="160" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="r10" value="Student clicks&lt;br&gt;verify link" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="160" y="810" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="r11" value="Login &amp;rarr; JWT issued" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="810" width="180" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="r12" value="Generate NaCl keypair&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Private &amp;rarr; IndexedDB | Public &amp;rarr; Server&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="380" y="890" width="220" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="r_end" value="APP READY" style="rounded=1;whiteSpace=wrap;html=1;arcSize=50;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="420" y="970" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="re1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="start" target="r1" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r1" target="r2" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re3" value="No" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" source="r2" target="r_stop" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re4" value="Yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" source="r2" target="r3" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r3" target="r4" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r4" target="r5" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r5" target="r6" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re8" value="No" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" source="r6" target="r7" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re9" value="Yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" source="r6" target="r8" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r7" target="r8" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r8" target="r9" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r9" target="r10" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r10" target="r11" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r11" target="r12" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="re15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="r12" target="r_end" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="fig5" name="Figure 5 - Create Group Chat">
    <mxGraphModel dx="1422" dy="850" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="g1" value="Tap &amp;ldquo;+&amp;rdquo; on&lt;br&gt;Messages page" style="rounded=1;whiteSpace=wrap;html=1;arcSize=50;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="140" y="40" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="g2" value="Choose:&lt;br&gt;DM or Group?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="160" y="140" width="120" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="g2a" value="DM flow" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="380" y="160" width="100" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="g3" value="Search school&lt;br&gt;directory&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;(same school only via RLS)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="130" y="290" width="180" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="g4" value="Select 2+ members" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="140" y="400" width="160" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="g5" value="Tap &amp;ldquo;Create Group (N)&amp;rdquo;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="130" y="490" width="180" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="g6" value="INSERT conversation&lt;br&gt;type: &amp;lsquo;group&amp;rsquo;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="500" y="400" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="g7" value="INSERT conversation_members&lt;br&gt;creator &amp;rarr; role: admin&lt;br&gt;others &amp;rarr; role: member" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="490" y="500" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="g8" value="Group appears in all&lt;br&gt;members&amp;rsquo; conversation lists&lt;br&gt;via Realtime subscription" style="rounded=1;whiteSpace=wrap;html=1;arcSize=50;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="480" y="620" width="220" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="ge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="g1" target="g2" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ge2" value="DM" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" source="g2" target="g2a" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ge3" value="Group" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" source="g2" target="g3" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="g3" target="g4" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="g4" target="g5" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="g5" target="g6" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="g6" target="g7" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="ge8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="g7" target="g8" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="fig6" name="Figure 6 - Encrypted File Sharing">
    <mxGraphModel dx="1422" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="1000">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="f_start" value="Tap paperclip &amp;rarr;&lt;br&gt;Select file" style="rounded=1;whiteSpace=wrap;html=1;arcSize=50;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="120" y="40" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="f1" value="1. Read file into memory" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="40" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="f2" value="2. Generate RANDOM&lt;br&gt;symmetric key&lt;br&gt;(NaCl Secretbox)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="130" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="f3" value="3. ENCRYPT file&lt;br&gt;with symmetric key" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="240" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="f4" value="4. For EACH member:&lt;br&gt;WRAP symmetric key&lt;br&gt;with their public key&lt;br&gt;(NaCl Box)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="340" width="200" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="f5" value="Upload encrypted&lt;br&gt;blob to Storage" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="740" y="250" width="160" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="f6" value="Save message with&lt;br&gt;file URL + wrapped keys" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="740" y="370" width="160" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="f_sep" value="RECIPIENT FLOW" style="text;html=1;fontSize=13;fontStyle=5;align=center;fillColor=#f5f5f5;strokeColor=#666666;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="500" width="200" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="f7" value="1. Download encrypted blob" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="570" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="f8" value="2. UNWRAP symmetric key&lt;br&gt;with own private key" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="650" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="f9" value="3. DECRYPT file&lt;br&gt;with symmetric key" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="740" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="f10" value="4. Display / Download" style="rounded=1;whiteSpace=wrap;html=1;arcSize=50;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="420" y="830" width="160" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="fe0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="f_start" target="f1" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="fe1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="f1" target="f2" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="fe2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="f2" target="f3" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="fe3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="f3" target="f4" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="fe4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="f3" target="f5" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="fe5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="f4" target="f6" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="fe6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="f7" target="f8" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="fe7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="f8" target="f9" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="fe8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="f9" target="f10" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="fig10" name="Figure 10 - ER Diagram">
    <mxGraphModel dx="1422" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="1000">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="t_auth" value="&lt;b&gt;auth.users&lt;/b&gt;&lt;hr&gt;PK id&lt;br&gt;email&lt;br&gt;password (bcrypt)&lt;br&gt;raw_user_meta_data" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="180" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="t_schools" value="&lt;b&gt;schools&lt;/b&gt;&lt;hr&gt;PK id&lt;br&gt;domain (UNIQUE)&lt;br&gt;name&lt;br&gt;logo_url" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="800" y="40" width="180" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="t_profiles" value="&lt;b&gt;profiles&lt;/b&gt;&lt;hr&gt;PK id &amp;rarr; auth.users&lt;br&gt;FK school_id &amp;rarr; schools&lt;br&gt;email&lt;br&gt;display_name&lt;br&gt;avatar_url&lt;br&gt;phone_number&lt;br&gt;preferred_language&lt;br&gt;is_verified&lt;br&gt;created_at" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="380" y="40" width="200" height="200" as="geometry"/>
        </mxCell>
        <mxCell id="t_push" value="&lt;b&gt;push_tokens&lt;/b&gt;&lt;hr&gt;PK id&lt;br&gt;FK user_id&lt;br&gt;token&lt;br&gt;device_info" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="310" width="160" height="110" as="geometry"/>
        </mxCell>
        <mxCell id="t_keys" value="&lt;b&gt;public_keys&lt;/b&gt;&lt;hr&gt;PK user_id&lt;br&gt;public_key (text)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="230" y="310" width="160" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="t_members" value="&lt;b&gt;conversation_members&lt;/b&gt;&lt;hr&gt;PK conversation_id&lt;br&gt;PK user_id&lt;br&gt;role (&amp;lsquo;admin&amp;rsquo; | &amp;lsquo;member&amp;rsquo;)&lt;br&gt;joined_at&lt;br&gt;last_read_at" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="420" y="310" width="200" height="130" as="geometry"/>
        </mxCell>
        <mxCell id="t_messages" value="&lt;b&gt;messages&lt;/b&gt;&lt;hr&gt;PK id&lt;br&gt;FK conversation_id&lt;br&gt;FK sender_id&lt;br&gt;content (encrypted)&lt;br&gt;type&lt;br&gt;file_url&lt;br&gt;created_at" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="660" y="310" width="180" height="160" as="geometry"/>
        </mxCell>
        <mxCell id="t_convos" value="&lt;b&gt;conversations&lt;/b&gt;&lt;hr&gt;PK id&lt;br&gt;type (&amp;lsquo;dm&amp;rsquo; | &amp;lsquo;group&amp;rsquo;)&lt;br&gt;name&lt;br&gt;FK school_id &amp;rarr; schools&lt;br&gt;FK created_by &amp;rarr; profiles&lt;br&gt;created_at&lt;br&gt;updated_at" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="420" y="540" width="220" height="170" as="geometry"/>
        </mxCell>
        <mxCell id="rel1" value="1:1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;endArrow=ERone;startArrow=ERone;" edge="1" source="t_auth" target="t_profiles" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="rel2" value="1:N" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;endArrow=ERmany;startArrow=ERone;" edge="1" source="t_schools" target="t_profiles" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="rel3" value="1:N" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;endArrow=ERmany;startArrow=ERone;" edge="1" source="t_profiles" target="t_push" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="rel4" value="1:1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;endArrow=ERone;startArrow=ERone;" edge="1" source="t_profiles" target="t_keys" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="rel5" value="1:N" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;endArrow=ERmany;startArrow=ERone;" edge="1" source="t_profiles" target="t_members" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="rel6" value="1:N" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;endArrow=ERmany;startArrow=ERone;" edge="1" source="t_profiles" target="t_messages" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="rel7" value="N:1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;endArrow=ERone;startArrow=ERmany;" edge="1" source="t_members" target="t_convos" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="rel8" value="N:1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;endArrow=ERone;startArrow=ERmany;" edge="1" source="t_messages" target="t_convos" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
      </root>
    </mxGraphModel>
  </diagram>

  <diagram id="fig11" name="Figure 11 - Data Flow">
    <mxGraphModel dx="1422" dy="850" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="d1" value="&lt;b&gt;Student&lt;/b&gt;&lt;br&gt;(Sender)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="60" y="40" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="d2" value="&lt;b&gt;Client&lt;/b&gt;&lt;br&gt;(Crypto Engine)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="320" y="40" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="d3" value="&lt;b&gt;Supabase&lt;/b&gt;&lt;br&gt;(Server)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="590" y="30" width="160" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="d4" value="&lt;b&gt;Student&lt;/b&gt;&lt;br&gt;(Reader)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="870" y="40" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="de1" value="Type message" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;entryX=0;entryY=0.5;" edge="1" source="d1" target="d2" parent="1">
          <mxGeometry x="-0.2" y="15" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry>
        </mxCell>
        <mxCell id="d_enc" value="Encrypt with&lt;br&gt;recipient&amp;rsquo;s public key" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="330" y="160" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="de2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="d2" target="d_enc" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="de3" value="Store ciphertext" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" source="d_enc" target="d3" parent="1"><mxGeometry x="-0.2" y="15" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell>
        <mxCell id="de4" value="Push via Realtime" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;" edge="1" source="d3" target="d4" parent="1">
          <mxGeometry x="-0.2" y="-15" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry>
        </mxCell>
        <mxCell id="d_dec" value="Decrypt with&lt;br&gt;own private key" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="870" y="160" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="de5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;" edge="1" source="d4" target="d_dec" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="de6" value="Display plaintext" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;dashed=1;" edge="1" source="d_dec" target="d4" parent="1">
          <mxGeometry x="0.2" y="15" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry>
        </mxCell>
        <mxCell id="de7" value="Mark as read" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;dashed=1;" edge="1" source="d4" target="d3" parent="1">
          <mxGeometry x="0.2" y="15" relative="1" as="geometry"><mxPoint y="1" as="offset"/></mxGeometry>
        </mxCell>
        <mxCell id="de8" value="Read receipt" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;fontSize=10;dashed=1;" edge="1" source="d3" target="d1" parent="1">
          <mxGeometry x="0.2" y="15" relative="1" as="geometry"><mxPoint y="1" as="offset"/></mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>

</mxfile>
