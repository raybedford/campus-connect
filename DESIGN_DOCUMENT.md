# CampusConnect - Application Design Document

## Table of Contents
1. [System Overview](#1-system-overview)
2. [Use Case Diagram](#2-use-case-diagram)
3. [Workflow Diagrams](#3-workflow-diagrams)
4. [Main Screen Visual Design](#4-main-screen-visual-design)
5. [Data Management](#5-data-management)

---

## 1. System Overview

CampusConnect is a secure, end-to-end encrypted (E2EE) messaging platform for
university students. Users verify identity with `.edu` emails, and all message
content is encrypted on-device before it ever reaches the server.

### 1.1 High-Level Architecture Flow

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚       STUDENT USER        â”‚
                          â”‚  (Browser / Mobile Web)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                  â–¼                  â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   SIGN UP    â”‚  â”‚   LOG IN     â”‚  â”‚  USE APP     â”‚
            â”‚   & VERIFY   â”‚  â”‚   (JWT)      â”‚  â”‚  (Messages,  â”‚
            â”‚   .edu email â”‚  â”‚              â”‚  â”‚   Files,     â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   Groups)    â”‚
                   â”‚                 â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼                 â–¼                 â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
            â”‚     SUPABASE AUTH (GoTrue)  â”‚            â”‚
            â”‚  - Email / password         â”‚            â”‚
            â”‚  - JWT session tokens       â”‚            â”‚
            â”‚  - Email verification       â”‚            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                          â”‚                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
         â–¼                â–¼                â–¼           â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  DATABASE  â”‚  â”‚  REALTIME   â”‚  â”‚  STORAGE   â”‚     â”‚
  â”‚ PostgreSQL â”‚  â”‚  WebSocket  â”‚  â”‚  S3 Files  â”‚â—€â”€â”€â”€â”€â”˜
  â”‚            â”‚  â”‚             â”‚  â”‚            â”‚
  â”‚ profiles   â”‚  â”‚ New message â”‚  â”‚ Encrypted  â”‚
  â”‚ messages   â”‚  â”‚ events      â”‚  â”‚ file blobs â”‚
  â”‚ schools    â”‚  â”‚ Typing      â”‚  â”‚            â”‚
  â”‚ keys       â”‚  â”‚ Presence    â”‚  â”‚            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              ALL messages & files encrypted
              CLIENT-SIDE before reaching server
              using NaCl Box (TweetNaCl.js)
```

### 1.2 Major Components

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                     CAMPUSCONNECT APP                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ FRONTEND    â”‚ CRYPTO       â”‚ BACKEND      â”‚ EXTERNAL        â”‚
  â”‚             â”‚              â”‚              â”‚                 â”‚
  â”‚ React 19   â”‚ NaCl Box     â”‚ Supabase     â”‚ Tenor (GIFs)    â”‚
  â”‚ TypeScript  â”‚ (messages)   â”‚ Auth         â”‚ MyMemory        â”‚
  â”‚ Zustand     â”‚              â”‚              â”‚ (Translation)   â”‚
  â”‚ (state)     â”‚ Secretbox    â”‚ PostgreSQL   â”‚                 â”‚
  â”‚             â”‚ (files)      â”‚ + RLS        â”‚ Clearbit        â”‚
  â”‚ React       â”‚              â”‚              â”‚ (School Logos)  â”‚
  â”‚ Router      â”‚ IndexedDB    â”‚ Realtime     â”‚                 â”‚
  â”‚             â”‚ (key store)  â”‚ (WebSocket)  â”‚                 â”‚
  â”‚ Vite        â”‚              â”‚              â”‚                 â”‚
  â”‚ (bundler)   â”‚ Key Manager  â”‚ Storage (S3) â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Use Case Diagram

### Actors

| Actor | Description |
|---|---|
| **Student** | Verified university student with a `.edu` email. Primary user of the system. |
| **System** | Backend automation: school detection, profile creation, real-time delivery, translation. |

### Use Case Diagram

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                         CAMPUSCONNECT                            â”‚
  â”‚                                                                  â”‚
  â”‚    AUTHENTICATION          MESSAGING             SETTINGS        â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚   â”‚              â”‚   â”‚                    â”‚  â”‚              â”‚   â”‚
  â”‚   â”‚ Register     â”‚   â”‚ Send Encrypted Msg â”‚  â”‚ Manage E2EE  â”‚   â”‚
  â”‚   â”‚ (.edu email) â”‚   â”‚                    â”‚  â”‚ Keys         â”‚   â”‚
  â”‚   â”‚              â”‚   â”‚ Create DM / Group  â”‚  â”‚              â”‚   â”‚
  â”‚   â”‚ Log In /     â”‚   â”‚                    â”‚  â”‚ Update       â”‚   â”‚
  â”‚   â”‚ Log Out      â”‚   â”‚ Share Encrypted    â”‚  â”‚ Profile      â”‚   â”‚
  â”‚   â”‚              â”‚   â”‚ File               â”‚  â”‚              â”‚   â”‚
  â”‚   â”‚ Reset        â”‚   â”‚                    â”‚  â”‚ Set Language â”‚   â”‚
  â”‚   â”‚ Password     â”‚   â”‚ Translate Message  â”‚  â”‚              â”‚   â”‚
  â”‚   â”‚              â”‚   â”‚                    â”‚  â”‚ Enable       â”‚   â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ View Read Receipts â”‚  â”‚ Notifs       â”‚   â”‚
  â”‚          â”‚           â”‚                    â”‚  â”‚              â”‚   â”‚
  â”‚          â”‚           â”‚ Add Group Member   â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚          â”‚           â”‚                    â”‚         â”‚           â”‚
  â”‚          â”‚           â”‚ Search / Send GIFs â”‚         â”‚           â”‚
  â”‚          â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â”‚
  â”‚          â”‚                     â”‚                    â”‚           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                     â”‚                    â”‚
             â–¼                     â–¼                    â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                          STUDENT                                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

             â–²                     â–²                    â–²
             â”‚                     â”‚                    â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Auto-Detect     â”‚  â”‚ Real-Time       â”‚  â”‚ Generate E2EE    â”‚
  â”‚ School          â”‚  â”‚ Delivery        â”‚  â”‚ Keypair          â”‚
  â”‚                 â”‚  â”‚                 â”‚  â”‚                  â”‚
  â”‚ Auto-Create     â”‚  â”‚ Typing/Presence â”‚  â”‚ Browser          â”‚
  â”‚ Profile         â”‚  â”‚ Indicators      â”‚  â”‚ Notifications    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚                     â”‚
           â–¼                    â–¼                     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                           SYSTEM                                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Workflow Diagrams

### 3.1 User Registration Flow

Who starts: **Student** | Through: **Auth + Database Trigger** | Result: **Profile + School + E2EE Keys**

```
  STUDENT                        AUTH SERVICE                 DATABASE                    CLIENT
  â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Enter name,   â”‚
  â”‚ .edu email,   â”‚
  â”‚ password      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   No
  â”‚ Email ends    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â–¶ [STOP: "Use a .edu email"]
  â”‚ with .edu?    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Yes
          â–¼
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  signUp()          â”‚ Create user   â”‚
          â”‚                    â”‚ in auth.users â”‚
          â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                            â”‚
          â”‚                            â”‚ TRIGGER: on_auth_user_created
          â”‚                            â–¼
          â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                    â”‚ Extract email domain      â”‚
          â”‚                    â”‚ student.coloradotech.edu  â”‚
          â”‚                    â”‚ â”€â”€â–¶ ctuonline.edu         â”‚
          â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                â”‚
          â”‚                                â–¼
          â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  No   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                    â”‚ School exists in  â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚ Create school    â”‚
          â”‚                    â”‚ database?         â”‚       â”‚ + fetch logo     â”‚
          â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                             â”‚ Yes                      â”‚
          â”‚                             â–¼â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                    â”‚ Create profile   â”‚
          â”‚                    â”‚ linked to school â”‚
          â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚â—€â”€â”€â”€ Verification email sent â”€â”€â”˜
          â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Click verify  â”‚
  â”‚ link in email â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  login()           â”‚ Return JWT    â”‚
          â”‚                    â”‚ session       â”‚
          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                                         â”‚ Generate NaCl    â”‚
          â”‚                                                         â”‚ keypair          â”‚
          â”‚                                                         â”‚                  â”‚
          â”‚                                                         â”‚ Private key â”€â”€â–¶  â”‚
          â”‚                                                         â”‚ IndexedDB        â”‚
          â”‚                                                         â”‚                  â”‚
          â”‚                                                         â”‚ Public key â”€â”€â”€â–¶  â”‚
          â”‚                                                â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Server           â”‚
          â”‚                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ APP READY     â”‚
  â”‚ Conversations â”‚
  â”‚ list shown    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.2 Send Encrypted Message Flow

Who starts: **Student A (Sender)** | Through: **Encryption + Realtime** | Result: **Student B reads decrypted message**

```
  STUDENT A (Sender)              ENCRYPTION ENGINE              SUPABASE               STUDENT B (Recipient)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Open chat     â”‚
  â”‚ with Student Bâ”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Type message  â”‚â”€â”€â”€â”€â”€â”€â–¶ Broadcast "typing"  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  "Student A is typing..."
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        indicator via                                        â— â— â—
          â”‚                Realtime channel
          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Press SEND    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Fetch B's public key â”‚â—€â”€â”€â”€ GET public_keys â”€â”€â”€â”
          â”‚               â”‚ from server          â”‚                        â”‚
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
          â”‚                          â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
          â”‚                          â–¼                             â”‚  Database   â”‚
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚               â”‚ ENCRYPT message      â”‚
          â”‚               â”‚                      â”‚
          â”‚               â”‚ NaCl Box:            â”‚
          â”‚               â”‚  A's private key     â”‚
          â”‚               â”‚  + B's public key    â”‚
          â”‚               â”‚  â”€â”€â–¶ ciphertext      â”‚
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚
          â”‚                          â–¼
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚ Encrypted JSON blob: â”‚
          â”‚               â”‚ [{                   â”‚
          â”‚               â”‚   recipient: B,      â”‚â”€â”€â”€â”€ INSERT messages â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚   ciphertext: "...", â”‚                         â”‚ Database â”‚
          â”‚               â”‚   nonce: "..."       â”‚                         â”‚ (stored  â”‚
          â”‚               â”‚ }]                   â”‚                         â”‚ encryptedâ”‚
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚ server   â”‚
          â”‚                                                                â”‚ CANNOT   â”‚
          â”‚                                                                â”‚ read it) â”‚
          â”‚                                                                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          â”‚                                                                     â”‚
          â”‚                                              Realtime: postgres_changes
          â”‚                                              push to all members â”€â”€â”€â”€â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                                                           â”‚ Receive event   â”‚
          â”‚                                                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                                                                    â”‚
          â”‚                                                                                    â–¼
          â”‚                                                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                                                           â”‚ DECRYPT message â”‚
          â”‚                                                                           â”‚                 â”‚
          â”‚                                                                           â”‚ NaCl Box:       â”‚
          â”‚                                                                           â”‚  B's private keyâ”‚
          â”‚                                                                           â”‚  + A's public   â”‚
          â”‚                                                                           â”‚  key            â”‚
          â”‚                                                                           â”‚  â”€â”€â–¶ plaintext  â”‚
          â”‚                                                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                                                                    â”‚
          â”‚                                                                                    â–¼
          â”‚                                                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                                                           â”‚ Display message â”‚
          â”‚                                                                           â”‚ in chat bubble  â”‚
          â”‚                                                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                                                                    â”‚
          â”‚                                              â—€â”€â”€ UPDATE last_read_at â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                                                              (Mark as read)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ See "Read âœ“"  â”‚
  â”‚ receipt       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.3 Share Encrypted File Flow

Who starts: **Student** | Through: **Symmetric + Asymmetric Encryption** | Result: **All members can decrypt file**

```
  STUDENT (Sender)                ENCRYPTION ENGINE                 SUPABASE
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Tap paperclip â”‚
  â”‚ Select file   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ 1. Read file into memory â”‚
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚
          â”‚                          â–¼
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚ 2. Generate RANDOM        â”‚
          â”‚               â”‚    symmetric key          â”‚
          â”‚               â”‚    (NaCl Secretbox)       â”‚
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚
          â”‚                          â–¼
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚ 3. ENCRYPT file with     â”‚
          â”‚               â”‚    symmetric key         â”‚
          â”‚               â”‚    â”€â”€â–¶ encrypted blob    â”‚
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚
          â”‚                          â–¼
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚ 4. For EACH member:      â”‚
          â”‚               â”‚    WRAP symmetric key    â”‚
          â”‚               â”‚    with their public key â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚    (NaCl Box)            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Upload blob â”‚
          â”‚               â”‚                          â”‚         â”‚ to Storage  â”‚
          â”‚               â”‚    Member A: wrapped_key â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚               â”‚    Member B: wrapped_key â”‚                â”‚
          â”‚               â”‚    Member C: wrapped_key â”‚                â–¼
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                                    â”‚ Save msg    â”‚
          â”‚                                                    â”‚ with file   â”‚
          â”‚                                                    â”‚ URL + all   â”‚
          â”‚                                                    â”‚ wrapped keysâ”‚
          â”‚                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚                     RECIPIENT FLOW:
          â”‚
          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚ 1. Download encrypted    â”‚
          â”‚               â”‚    blob from Storage     â”‚
          â”‚               â”‚                          â”‚
          â”‚               â”‚ 2. UNWRAP symmetric key  â”‚
          â”‚               â”‚    with own private key  â”‚
          â”‚               â”‚    (NaCl Box)            â”‚
          â”‚               â”‚                          â”‚
          â”‚               â”‚ 3. DECRYPT file with     â”‚
          â”‚               â”‚    symmetric key         â”‚
          â”‚               â”‚    (NaCl Secretbox)      â”‚
          â”‚               â”‚                          â”‚
          â”‚               â”‚ 4. Display / download    â”‚
          â”‚               â”‚    original file         â”‚
          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.4 Create Group Conversation Flow

Who starts: **Student** | Through: **Conversation API** | Result: **Group chat ready for all members**

```
  STUDENT                                          SUPABASE
  â”€â”€â”€â”€â”€â”€â”€                                          â”€â”€â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Tap "+" on   â”‚
  â”‚ Messages pageâ”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Choose mode: â”‚
  â”‚ DM or GROUP  â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Group
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Search and   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Query school â”‚
  â”‚ browse       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ directory    â”‚
  â”‚ students     â”‚         â”‚ (same school â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ only via RLS)â”‚
         â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Select 2+    â”‚
  â”‚ members      â”‚
  â”‚ (checkmarks) â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Enter group  â”‚
  â”‚ name         â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Tap "Create  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ INSERT conversations             â”‚
  â”‚ Group (N)"   â”‚         â”‚   type: 'group'                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   name: "Study Group"            â”‚
                           â”‚   created_by: student            â”‚
                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                           â”‚ INSERT conversation_members      â”‚
                           â”‚   creator  â”€â”€â–¶ role: 'admin'     â”‚
                           â”‚   member 1 â”€â”€â–¶ role: 'member'    â”‚
                           â”‚   member 2 â”€â”€â–¶ role: 'member'    â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ Group appears in ALL members'    â”‚
                           â”‚ conversation lists via Realtime  â”‚
                           â”‚                                  â”‚
                           â”‚ Ready for encrypted messaging    â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.5 Notification Flow

Who starts: **System (on new message)** | Through: **Realtime + Browser API** | Result: **Recipient sees notification**

```
  STUDENT A                     SUPABASE                    STUDENT B's BROWSER
  â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Send message â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Store in DB  â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â”‚                     â”‚ Realtime: postgres_changes
         â”‚                     â”‚
         â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                                â”‚ Is Student B on     â”‚
         â”‚                     â”‚                                â”‚ this conversation?  â”‚
         â”‚                     â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                                           â”‚
         â”‚                     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                                    â”‚             â”‚
         â”‚                     â”‚                                   YES           NO
         â”‚                     â”‚                                    â”‚             â”‚
         â”‚                     â”‚                                    â–¼             â–¼
         â”‚                     â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                              â”‚ Show in  â”‚ â”‚ Show browser â”‚
         â”‚                     â”‚                              â”‚ chat     â”‚ â”‚ notification â”‚
         â”‚                     â”‚                              â”‚ (no      â”‚ â”‚              â”‚
         â”‚                     â”‚                              â”‚ notif)   â”‚ â”‚ "Student A"  â”‚
         â”‚                     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ Sent you a   â”‚
         â”‚                     â”‚                                           â”‚ new message  â”‚
         â”‚                     â”‚                                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                                                  â”‚ Click
         â”‚                     â”‚                                                  â–¼
         â”‚                     â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                                           â”‚ Navigate to  â”‚
         â”‚                     â”‚                                           â”‚ conversation â”‚
         â”‚                     â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Main Screen Visual Design

### 4.1 Design System

```
  COLOR PALETTE                              TYPOGRAPHY
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Background:  #0a0a0a  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               Font: system-ui, sans-serif
  Cards:       #1a1a1a  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               Headings: Bold, gold
  Hover:       #2a2a2a  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               Body: Regular, cream
  Gold:        #cfb87c  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               Captions: Small, dim
  Cream:       #f5f0e8  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  Dim:         #a09880  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               PRINCIPLES
  Online:      #4caf50  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Error:       #f44336  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               Dark theme, gold accents
                                             Responsive mobile-first
                                             Content-first, minimal chrome
```

### 4.2 Mobile: Conversation List (Main Screen)

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ›  Campus Connect   [CTU Online] âœ“ â”‚  Navbar
  â”‚         Messages  Directory  âš™       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  Messages                      [+]  â”‚  Header
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                      â”‚
  â”‚  â”Œâ”€â”€â”  Jane Doe             2:30p   â”‚
  â”‚  â”‚JDâ”‚  ğŸ”’ Encrypted message     â—2  â”‚  Conversation
  â”‚  â””â”€â”€â”˜                               â”‚  Card
  â”‚ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”‚
  â”‚  â”Œâ”€â”€â”  Study Group           1:15p  â”‚
  â”‚  â”‚SGâ”‚  ğŸ”’ Encrypted message         â”‚
  â”‚  â””â”€â”€â”˜                               â”‚
  â”‚ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”‚
  â”‚  â”Œâ”€â”€â”  Alex Brown           11:00a  â”‚
  â”‚  â”‚ABâ”‚  ğŸ”’ Encrypted message         â”‚
  â”‚  â””â”€â”€â”˜                               â”‚
  â”‚ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”‚
  â”‚  â”Œâ”€â”€â”  CS 101 Group          Yest.  â”‚
  â”‚  â”‚CSâ”‚  ğŸ”’ Encrypted message         â”‚
  â”‚  â””â”€â”€â”˜                               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Mobile: Chat View

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  â† Jane Doe              [+Add][ğŸ“] â”‚  Header
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                      â”‚
  â”‚         Wednesday, Feb 26            â”‚
  â”‚                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  Incoming
  â”‚  â”‚ Hey, are you in     â”‚             â”‚  (left, gray)
  â”‚  â”‚ Prof. Smith's class?â”‚             â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
  â”‚   Jane Â· 2:15 PM                     â”‚
  â”‚                                      â”‚
  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  Own message
  â”‚            â”‚ Yeah! Section 2.    â”‚   â”‚  (right, gold)
  â”‚            â”‚ Want to study       â”‚   â”‚
  â”‚            â”‚ together?           â”‚   â”‚
  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                   2:16 PM Â· Read âœ“   â”‚
  â”‚                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
  â”‚  â”‚ Definitely! I'll    â”‚             â”‚
  â”‚  â”‚ create a group chat â”‚             â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
  â”‚   Jane Â· 2:17 PM                     â”‚
  â”‚                                      â”‚
  â”‚   Jane is typing  â— â— â—             â”‚
  â”‚                                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ğŸ˜Š GIF ğŸ“ â”‚ Type a message...   â”‚ â¤ â”‚  Input
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 Desktop: Split Panel Layout

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ› Campus Connect      CTU Online âœ“      Messages  Directory  âš™  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                       â”‚                                             â”‚
  â”‚ Messages        [+]  â”‚  â† Jane Doe                  [+Add] [ğŸ“]   â”‚
  â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”‚
  â”‚                       â”‚                                             â”‚
  â”‚ â–ˆâ–ˆ Jane Doe    2:30p  â”‚         Wednesday, Feb 26                   â”‚
  â”‚    ğŸ”’ Encrypted   â—2  â”‚                                             â”‚
  â”‚                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
  â”‚ â–ˆâ–ˆ Study Grp   1:15p  â”‚  â”‚ Hey, are you in  â”‚                      â”‚
  â”‚    ğŸ”’ Encrypted        â”‚  â”‚ Prof. Smith's?   â”‚                      â”‚
  â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
  â”‚ â–ˆâ–ˆ Alex B.    11:00a  â”‚   Jane Â· 2:15 PM                           â”‚
  â”‚    ğŸ”’ Encrypted        â”‚                                             â”‚
  â”‚                       â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
  â”‚ â–ˆâ–ˆ CS 101      Yest.  â”‚           â”‚ Yeah! Section 2. â”‚              â”‚
  â”‚    ğŸ”’ Encrypted        â”‚           â”‚ Want to study    â”‚              â”‚
  â”‚                       â”‚           â”‚ together?        â”‚              â”‚
  â”‚                       â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
  â”‚                       â”‚                  2:16 PM Â· Read âœ“           â”‚
  â”‚                       â”‚                                             â”‚
  â”‚                       â”‚   Jane is typing  â— â— â—                    â”‚
  â”‚                       â”‚                                             â”‚
  â”‚                       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚                       â”‚ â”‚ ğŸ˜Š GIF ğŸ“ â”‚ Type a message...     â”‚ â¤ â”‚ â”‚
  â”‚                       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Data Management

### 5.1 Entity-Relationship Diagram

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  auth.users  â”‚                              â”‚   schools    â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚ PK id        â”‚                              â”‚ PK id        â”‚
  â”‚    email     â”‚                              â”‚    domain    â”‚
  â”‚    password  â”‚                              â”‚    name      â”‚
  â”‚    metadata  â”‚                              â”‚    logo_url  â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:1                                         â”‚ 1:many
         â”‚                                             â”‚
         â–¼                                             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                        profiles                              â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚ PK id â”€â”€FKâ”€â”€â–¶ auth.users    FK school_id â”€â”€FKâ”€â”€â–¶ schools   â”‚
  â”‚    email    display_name    avatar_url    phone_number      â”‚
  â”‚    preferred_language       is_verified   created_at        â”‚
  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 1:many       â”‚ 1:1             â”‚ 1:many         â”‚ 1:many
      â”‚              â”‚                 â”‚                â”‚
      â–¼              â–¼                 â–¼                â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚push_     â”‚  â”‚public_   â”‚  â”‚conversation_ â”‚  â”‚messages  â”‚
  â”‚tokens    â”‚  â”‚keys      â”‚  â”‚members       â”‚  â”‚          â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚PK id     â”‚  â”‚PK user_idâ”‚  â”‚PK conv_id   â”‚  â”‚PK id     â”‚
  â”‚FK user_idâ”‚  â”‚  pub_key â”‚  â”‚PK user_id   â”‚  â”‚FK conv_idâ”‚
  â”‚   token  â”‚  â”‚          â”‚  â”‚   role       â”‚  â”‚FK sender â”‚
  â”‚   device â”‚  â”‚          â”‚  â”‚   joined_at  â”‚  â”‚  content â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   last_read  â”‚  â”‚  type    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  file_urlâ”‚
                                     â”‚ many:1   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                     â”‚               â”‚ many:1
                                     â–¼               â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚       conversations        â”‚
                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                              â”‚ PK id                      â”‚
                              â”‚    type ('dm' | 'group')   â”‚
                              â”‚    name                    â”‚
                              â”‚ FK school_id â”€â”€â–¶ schools   â”‚
                              â”‚ FK created_by â”€â”€â–¶ profiles â”‚
                              â”‚    created_at, updated_at  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Security: Row-Level Security (RLS)

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ TABLE               â”‚ SELECT     â”‚ INSERT         â”‚ UPDATE         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ schools             â”‚ Everyone   â”‚ System only    â”‚ â€”              â”‚
  â”‚ profiles            â”‚ Everyone   â”‚ System only    â”‚ Own only       â”‚
  â”‚ conversations       â”‚ Members *  â”‚ Creator        â”‚ Members *      â”‚
  â”‚ conversation_membersâ”‚ Members *  â”‚ Authenticated  â”‚ Own only       â”‚
  â”‚ messages            â”‚ Members *  â”‚ Sender+Member* â”‚ Members *      â”‚
  â”‚ public_keys         â”‚ Auth users â”‚ Own only       â”‚ Own only       â”‚
  â”‚ push_tokens         â”‚ Own only   â”‚ Own only       â”‚ Own only       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  * "Members" = must be in conversation_members for that conversation
    Enforced by get_my_conv_ids() helper to prevent recursive RLS
```

### 5.3 Encryption Model

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    WHAT IS ENCRYPTED WHERE                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Data               â”‚ Location         â”‚ Encryption                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Message text       â”‚ messages.content â”‚ NaCl Box (per-recipient)     â”‚
  â”‚ File contents      â”‚ Supabase Storage â”‚ NaCl Secretbox (symmetric)   â”‚
  â”‚ File keys          â”‚ messages.content â”‚ NaCl Box (wrapped/recipient) â”‚
  â”‚ Private keys       â”‚ IndexedDB        â”‚ Local device only            â”‚
  â”‚ Public keys        â”‚ public_keys      â”‚ Plaintext (public by design) â”‚
  â”‚ Passwords          â”‚ auth.users       â”‚ bcrypt (managed by Supabase) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  KEY PRINCIPLE: The server stores ONLY ciphertext.
  Decryption happens ONLY in the user's browser.
  Even database administrators cannot read message content.
```

### 5.4 Data Flow Summary

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Student  â”‚     â”‚   Client   â”‚     â”‚  Supabase  â”‚     â”‚ Student  â”‚
  â”‚ (Actor)  â”‚     â”‚  (Crypto)  â”‚     â”‚  (Server)  â”‚     â”‚ (Reader) â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                   â”‚                 â”‚
       â”‚  Type message   â”‚                   â”‚                 â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
       â”‚                 â”‚                   â”‚                 â”‚
       â”‚                 â”‚  Encrypt with     â”‚                 â”‚
       â”‚                 â”‚  recipient's      â”‚                 â”‚
       â”‚                 â”‚  public key       â”‚                 â”‚
       â”‚                 â”‚                   â”‚                 â”‚
       â”‚                 â”‚  Store encrypted  â”‚                 â”‚
       â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
       â”‚                 â”‚                   â”‚                 â”‚
       â”‚                 â”‚                   â”‚  Push via       â”‚
       â”‚                 â”‚                   â”‚  Realtime       â”‚
       â”‚                 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
       â”‚                 â”‚                   â”‚                 â”‚
       â”‚                 â”‚                   â”‚        Decrypt  â”‚
       â”‚                 â”‚                   â”‚        with own â”‚
       â”‚                 â”‚                   â”‚        private  â”‚
       â”‚                 â”‚                   â”‚        key      â”‚
       â”‚                 â”‚                   â”‚                 â”‚
       â”‚                 â”‚                   â”‚        Display  â”‚
       â”‚                 â”‚                   â”‚        message  â”‚
       â”‚                 â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                 â”‚                   â”‚  Mark as read   â”‚
       â”‚                 â”‚                   â”‚                 â”‚
       â”‚  See "Read âœ“"  â”‚                   â”‚                 â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
       â”‚                 â”‚   Realtime update â”‚                 â”‚
       â–¼                 â–¼                   â–¼                 â–¼
```

### 5.5 Storage Considerations

| Concern | Approach |
|---|---|
| **Message Growth** | Append-only. Paginated queries (`LIMIT`) prevent loading full history. |
| **File Storage** | Encrypted blobs in Supabase Storage. Scales with plan. |
| **Key Rotation** | Single keypair per user. New devices import via recovery code. |
| **Orphaned Data** | `ON DELETE CASCADE` on all foreign keys for clean user removal. |
| **Indexing** | Composite PK `(conversation_id, user_id)` on members for fast lookups. |
| **Realtime** | Per-conversation channels. Typing/presence use lightweight broadcasts. |

---

*CampusConnect â€” Secure University Messaging Platform*
*React 19 + Supabase + TweetNaCl.js (NaCl Box E2EE)*
