<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CampusConnect Application Design Document</title>
<style>
  @page {
    margin: 1in;
    size: letter;
  }
  body {
    font-family: 'Times New Roman', Times, serif;
    font-size: 12pt;
    line-height: 2;
    color: #000;
    margin: 1in;
    background: #fff;
  }
  p {
    text-indent: 0.5in;
    margin: 0 0 0 0;
  }
  p.no-indent {
    text-indent: 0;
  }
  h1, h2, h3 {
    font-family: 'Times New Roman', Times, serif;
    margin-top: 12pt;
    margin-bottom: 0;
  }
  /* APA 7 Level 1: Centered, Bold, Title Case */
  h1 {
    text-align: center;
    font-weight: bold;
    font-size: 12pt;
  }
  /* APA 7 Level 2: Left-Aligned, Bold, Title Case */
  h2 {
    text-align: left;
    font-weight: bold;
    font-size: 12pt;
  }
  /* APA 7 Level 3: Left-Aligned, Bold Italic, Title Case */
  h3 {
    text-align: left;
    font-weight: bold;
    font-style: italic;
    font-size: 12pt;
  }
  .title-page {
    text-align: center;
    margin-top: 3in;
    page-break-after: always;
  }
  .title-page h1 {
    font-size: 12pt;
    font-weight: bold;
    margin-bottom: 24pt;
  }
  .title-page p {
    text-indent: 0;
    line-height: 2;
  }
  .page-break {
    page-break-before: always;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin: 12pt 0;
    font-size: 11pt;
    line-height: 1.5;
  }
  th, td {
    border-top: none;
    border-bottom: 1px solid #000;
    border-left: none;
    border-right: none;
    padding: 6px 10px;
    text-align: left;
    vertical-align: top;
  }
  thead tr:first-child th {
    border-top: 2px solid #000;
    border-bottom: 1px solid #000;
  }
  tbody tr:last-child td {
    border-bottom: 2px solid #000;
  }
  th {
    font-weight: bold;
  }
  pre {
    font-family: 'Courier New', Courier, monospace;
    font-size: 9pt;
    line-height: 1.4;
    background: #f9f9f9;
    border: 1px solid #ccc;
    padding: 12px;
    margin: 12pt 0;
    overflow-x: auto;
    white-space: pre;
    page-break-inside: avoid;
  }
  .figure-caption {
    font-style: italic;
    text-align: left;
    text-indent: 0;
    margin: 6pt 0 12pt 0;
    font-size: 12pt;
  }
  .figure-label {
    font-weight: bold;
    font-style: italic;
  }
  .references p {
    text-indent: -0.5in;
    padding-left: 0.5in;
  }
  .abstract {
    margin-bottom: 0;
  }
  .keywords {
    text-indent: 0.5in;
    font-style: italic;
  }
  .table-note {
    text-indent: 0;
    font-size: 10pt;
    font-style: italic;
    line-height: 1.8;
  }
  .diagram-note {
    text-indent: 0;
    font-size: 10pt;
    color: #555;
    margin: 4pt 0 12pt 0;
    line-height: 1.5;
  }
</style>
</head>
<body>

<!-- TITLE PAGE -->
<div class="title-page">
  <h1>CampusConnect: Design and Architecture of a Secure<br>End-to-End Encrypted University Messaging Platform</h1>
  <p>Student Name</p>
  <p>Colorado Technical University</p>
  <p>Course Name and Number</p>
  <p>Instructor Name</p>
  <p>March 1, 2026</p>
</div>

<!-- ABSTRACT -->
<div class="page-break"></div>
<h1>Abstract</h1>
<p class="abstract no-indent">CampusConnect is a messaging application I built for university students that uses end-to-end encryption so the server never sees what anyone types. The app only lets people sign up with .edu emails, which ties each user to their school automatically. Once signed up, students can send messages, share files, create group chats, and see who is online &mdash; all through a real-time interface. The encryption piece uses a library called NaCl, which handles both the asymmetric key exchange and the symmetric file encryption (Bernstein et al., 2012). On the backend, everything runs through Supabase, which gives me a PostgreSQL database, authentication, real-time websockets, and file storage without having to manage my own servers. This document walks through the system architecture and its major components, four detailed use cases with workflow diagrams, the visual design for both mobile and desktop screens, and the data management strategy including the full database schema and row-level security setup.</p>
<p class="keywords">Keywords: end-to-end encryption, messaging, NaCl, Supabase, React, university, software design</p>

<!-- BODY -->
<div class="page-break"></div>
<h1>CampusConnect: Design and Architecture of a Secure End-to-End Encrypted University Messaging Platform</h1>

<h1>System Architecture</h1>

<h2>Overview</h2>
<p>The idea behind CampusConnect is straightforward: give college students a way to message each other securely without trusting the server with their conversations. I went with a single-page application using React 19 and TypeScript on the frontend, and Supabase as the backend. Supabase is essentially an open-source Firebase alternative that bundles together PostgreSQL, auth, realtime subscriptions, and file storage (Supabase, 2024). It saved me from standing up separate services for each of those things.</p>

<p>The part that makes this different from a standard chat app is that all encryption and decryption happens in the browser. The server stores ciphertext and has no way to read it. Ermoshina et al. (2016) call this a "zero-knowledge architecture" because even a compromised backend cannot expose message content (p. 12). That constraint shaped a lot of my design decisions &mdash; for example, the server-side translation feature has to run after decryption on the client, not as a server middleware.</p>

<p>Structurally, the app follows a three-tier pattern. The presentation layer is React components. The middle layer handles encryption, state management with Zustand, and API calls. The data layer is Supabase PostgreSQL with Row-Level Security policies controlling who can read and write what. Bass et al. (2012) argue that keeping these layers separate lets you change one without breaking the others, and that has held true &mdash; I was able to swap out the notification system without touching the encryption layer at all.</p>

<h2>High-Level Architecture Diagram</h2>
<p class="no-indent"><span class="figure-label">Figure 1</span></p>
<p class="figure-caption">Three-Tier System Architecture and Data Flow</p>
<pre>
                          +----------------------------+
                          |       STUDENT USER         |
                          |   (Browser / Mobile Web)   |
                          +-------------+--------------+
                                        |
                    +-------------------+-------------------+
                    v                   v                   v
            +--------------+   +--------------+   +--------------+
            |   SIGN UP    |   |   LOG IN     |   |  USE APP     |
            |   & VERIFY   |   |   (JWT)      |   |  (Messages,  |
            |   .edu email |   |              |   |   Files,     |
            +------+-------+   +------+-------+   |   Groups)    |
                   |                  |            +------+-------+
                   v                  v                   |
            +-----------------------------+               |
            |     SUPABASE AUTH (GoTrue)  |               |
            |  - Email / password         |               |
            |  - JWT session tokens       |               |
            |  - Email verification       |               |
            +-------------+---------------+               |
                          |                               |
         +----------------+----------------+              |
         v                v                v              |
  +------------+  +-------------+  +------------+         |
  |  DATABASE  |  |  REALTIME   |  |  STORAGE   |&lt;-------+
  | PostgreSQL |  |  WebSocket  |  |  S3 Files  |
  |            |  |             |  |            |
  | profiles   |  | New message |  | Encrypted  |
  | messages   |  | events      |  | file blobs |
  | schools    |  | Typing      |  |            |
  | keys       |  | Presence    |  |            |
  +------------+  +-------------+  +------------+

           ALL messages and files encrypted
           CLIENT-SIDE before reaching server
           using NaCl Box (TweetNaCl.js)
</pre>
<p class="diagram-note">Editable version available in <strong>diagrams.drawio</strong> (import into Lucidchart via File &gt; Import or open in draw.io).</p>

<h2>Major Application Components</h2>
<p>I broke the app down into nine components. Some of these, like the messaging engine and encryption layer, are tightly coupled by necessity &mdash; you cannot send a message without encrypting it first. Others, like translation and notifications, are more loosely attached and could be removed without breaking core functionality.</p>

<p class="no-indent"><span class="figure-label">Table 1</span></p>
<p class="figure-caption">Major Application Components and Technologies</p>
<table>
  <thead>
    <tr><th>Component</th><th>Purpose</th><th>Key Technologies</th></tr>
  </thead>
  <tbody>
    <tr><td>Authentication</td><td>Registration, login, password reset, and email verification. Only .edu emails allowed.</td><td>Supabase Auth (GoTrue), JWT</td></tr>
    <tr><td>Messaging Engine</td><td>Send and receive encrypted text in real-time across DMs and group chats.</td><td>Supabase Realtime, Zustand</td></tr>
    <tr><td>E2EE Crypto Layer</td><td>Client-side encrypt/decrypt for all messages and files. Private keys stay on device.</td><td>TweetNaCl.js (NaCl Box, Secretbox), IndexedDB</td></tr>
    <tr><td>School Directory</td><td>Browse and search verified students at the same university.</td><td>Supabase RLS, PostgreSQL</td></tr>
    <tr><td>Presence &amp; Typing</td><td>Show who is online and who is currently typing in a conversation.</td><td>Supabase Broadcast + Presence</td></tr>
    <tr><td>File Sharing</td><td>Encrypted file uploads with per-recipient key wrapping.</td><td>NaCl Secretbox, Supabase Storage</td></tr>
    <tr><td>Translation</td><td>Auto-translate incoming messages based on the user's language preference.</td><td>MyMemory Translation API</td></tr>
    <tr><td>School Detection</td><td>Auto-detect university from email domain during signup.</td><td>PostgreSQL trigger function</td></tr>
    <tr><td>Notifications</td><td>In-app bell icon and browser push alerts for new messages.</td><td>Web Notifications API, Supabase Realtime</td></tr>
  </tbody>
</table>

<h1>Use Case Analysis</h1>

<h2>Actors</h2>
<p>There are really only two actors in the system. The <strong>Student</strong> is anyone with a verified .edu email &mdash; they send messages, create conversations, share files, and manage their settings. The <strong>System</strong> handles the automated stuff that happens behind the scenes: detecting which school someone belongs to, creating their profile, generating encryption keys, delivering messages in real-time, and sending notifications.</p>

<h2>Use Case Diagram</h2>
<p class="no-indent"><span class="figure-label">Figure 2</span></p>
<p class="figure-caption">Use Case Diagram for Student and System Interactions</p>
<pre>
  +------------------------------------------------------------------+
  |                         CAMPUSCONNECT                            |
  |                                                                  |
  |    AUTHENTICATION          MESSAGING             SETTINGS        |
  |   +--------------+   +--------------------+  +--------------+   |
  |   |              |   |                    |  |              |   |
  |   | Register     |   | Send Encrypted Msg |  | Manage E2EE  |   |
  |   | (.edu email) |   |                    |  | Keys         |   |
  |   |              |   | Create DM / Group  |  |              |   |
  |   | Log In /     |   |                    |  | Update       |   |
  |   | Log Out      |   | Share Encrypted    |  | Profile      |   |
  |   |              |   | File               |  |              |   |
  |   | Reset        |   |                    |  | Set Language |   |
  |   | Password     |   | Translate Message  |  |              |   |
  |   |              |   |                    |  | Enable       |   |
  |   +--------------+   | View Read Receipts |  | Notifs       |   |
  |          |           |                    |  |              |   |
  |          |           | Add Group Member   |  +--------------+   |
  |          |           |                    |         |           |
  |          |           | Search / Send GIFs |         |           |
  |          |           +--------------------+         |           |
  |          |                     |                    |           |
  +------------------------------------------------------------------+
             |                     |                    |
             v                     v                    v
                          STUDENT (Actor)
             ^                     ^                    ^
             |                     |                    |
  +------------------+  +------------------+  +------------------+
  | Auto-Detect      |  | Real-Time        |  | Generate E2EE    |
  | School           |  | Delivery         |  | Keypair          |
  |                  |  |                  |  |                  |
  | Auto-Create      |  | Typing/Presence  |  | Browser          |
  | Profile          |  | Indicators       |  | Notifications    |
  +------------------+  +------------------+  +------------------+
                          SYSTEM (Actor)
</pre>

<h2>Detailed Use Cases</h2>

<h3>Use Case 1: Send Encrypted Message</h3>
<p>This is the core of the whole application. When a student hits Send, the browser grabs the recipient's public key from the database, then uses NaCl Box to combine that public key with the sender's private key and produce a ciphertext (Bernstein et al., 2012). That ciphertext goes to the server, where it sits unreadable. On the other end, the recipient's browser does the reverse &mdash; their private key plus the sender's public key decrypts it back to plaintext. The server is just a relay; it never knows what the message says.</p>

<p class="no-indent"><span class="figure-label">Table 2</span></p>
<p class="figure-caption">Use Case Specification: Send Encrypted Message</p>
<table>
  <thead>
    <tr><th>Field</th><th>Detail</th></tr>
  </thead>
  <tbody>
    <tr><td>Use Case ID</td><td>UC-1</td></tr>
    <tr><td>Name</td><td>Send Encrypted Message</td></tr>
    <tr><td>Actor</td><td>Student</td></tr>
    <tr><td>Preconditions</td><td>Student is logged in, has an E2EE keypair, and belongs to the conversation.</td></tr>
    <tr><td>Trigger</td><td>Student types a message and taps Send.</td></tr>
  </tbody>
</table>

<p class="no-indent"><span class="figure-label">Figure 3</span></p>
<p class="figure-caption">Workflow: Sending an Encrypted Message</p>
<pre>
  STUDENT A (Sender)           ENCRYPTION ENGINE           SUPABASE              STUDENT B (Recipient)
  ------------------           -----------------           --------              ---------------------

  +---------------+
  | Type message  |----> Broadcast "typing"  ---------------------------->  "Student A is typing..."
  +-------+-------+      indicator via
          |               Realtime channel
          v
  +---------------+
  | Press SEND    |
  +-------+-------+
          |
          |            +----------------------+
          +----------->| Fetch B's public key |<--- GET public_keys -----+
          |            +----------+-----------+                          |
          |                       |                              +-------+-----+
          |                       v                              |  Database   |
          |            +----------------------+                  +-------------+
          |            | ENCRYPT message      |
          |            |                      |
          |            | NaCl Box:            |
          |            |  A's private key     |
          |            |  + B's public key    |
          |            |  --> ciphertext      |
          |            +----------+-----------+
          |                       |
          |                       v
          |            +----------------------+
          |            | Encrypted JSON blob  |
          |            | [{                   |--- INSERT messages --->  +----------+
          |            |   recipient: B,      |                         | Database |
          |            |   ciphertext: "...", |                         | (stored  |
          |            |   nonce: "..."       |                         | encrypted|
          |            | }]                   |                         | server   |
          |            +----------------------+                         | CANNOT   |
          |                                                             | read it) |
          |                                                             +----+-----+
          |                                                                  |
          |                                          Realtime push --------->+
          |                                                                  |
          |                                                           +------v--------+
          |                                                           | DECRYPT msg   |
          |                                                           | NaCl Box:     |
          |                                                           |  B's private  |
          |                                                           |  + A's public |
          |                                                           |  --> plaintext|
          |                                                           +------+--------+
          |                                                                  |
          |                                                           +------v--------+
          |                                                           | Display in    |
          |                                                           | chat bubble   |
          |                                                           +------+--------+
          |                                                                  |
          |                                   <-- UPDATE last_read_at -------+
  +-------v-------+
  | See "Read"    |
  | receipt       |
  +---------------+
</pre>

<p><strong>Main Flow:</strong> (1) Student opens a conversation. (2) Prior messages are loaded and decrypted. (3) Student types, which triggers a typing indicator broadcast. (4) Student presses Send. (5) The browser fetches the recipient's public key. (6) NaCl Box encrypts the message for each recipient. (7) The ciphertext is inserted into the messages table. (8) Supabase Realtime pushes the new row to all conversation members. (9) Each recipient's browser decrypts it locally. (10) A database trigger updates the conversation timestamp.</p>

<p><strong>Postconditions:</strong> Encrypted message stored in database. Online recipients see decrypted text in real-time. Conversation timestamp updated.</p>

<h3>Use Case 2: Register and Join School</h3>
<p>Registration is where a lot of the automation kicks in. The student fills out a form with their name, .edu email, and a password. If the email does not end in .edu, the frontend blocks the submission immediately. Assuming it passes, Supabase Auth creates the user, which fires a PostgreSQL trigger called handle_new_user(). That trigger function pulls the domain out of the email, strips common subdomains like "student." or "mail.", and looks up whether a school record already exists. If not, it creates one and even fetches a logo from Clearbit. Then it creates the student's profile linked to that school. All of this happens in a single database transaction (Sommerville, 2015).</p>

<p class="no-indent"><span class="figure-label">Figure 4</span></p>
<p class="figure-caption">Workflow: User Registration and Automatic School Detection</p>
<pre>
  STUDENT                     AUTH SERVICE              DATABASE TRIGGER            DATABASE
  -------                     ------------              ----------------            --------

  +---------------+
  | Enter name,   |
  | .edu email,   |
  | password      |
  +-------+-------+
          |
          v
  +---------------+   No
  | Email ends    +-------->  [STOP: "Use a .edu email"]
  | with .edu?    |
  +-------+-------+
          | Yes
          v
          +-----------------> +---------------+
          |  signUp()         | Create user   |
          |                   | in auth.users |
          |                   +-------+-------+
          |                           |
          |                           | TRIGGER: on_auth_user_created
          |                           v
          |                   +---------------------------+
          |                   | Extract email domain      |
          |                   | student.coloradotech.edu  |
          |                   | Strip "student." prefix   |
          |                   | Map to --> ctuonline.edu  |
          |                   +-----------+---------------+
          |                               |
          |                               v
          |                   +------------------+  No   +------------------+
          |                   | School exists?   +------>| Create school    |
          |                   +--------+---------+       | + fetch logo     |
          |                            | Yes             +--------+---------+
          |                            v<-------------------------+
          |                   +------------------+
          |                   | Create profile   |
          |                   | linked to school |
          |                   +------------------+
          |
          |<--- Verification email sent ---+
          |
  +-------+-------+
  | Click verify   |
  | link in email  |
  +-------+-------+
          |
          +-----------------> +---------------+
          |  login()          | Return JWT    |
          |                   +-------+-------+
          |<--------------------------+
          |
          |                                                      +-----------------+
          |                                                      | Generate NaCl   |
          |                                                      | keypair         |
          |                                                      |                 |
          |                                                      | Private key --> |
          |                                                      | IndexedDB       |
          |                                                      |                 |
          |                                                      | Public key -->  |
          |                                                      +-----------------+
  +---------------+
  | APP READY     |
  +---------------+
</pre>

<p><strong>Main Flow:</strong> (1) Student fills out the signup form with their .edu email. (2) Frontend validates the domain. (3) Supabase Auth creates the user record. (4) The handle_new_user() trigger parses the domain, strips prefixes, and resolves the school. (5) Trigger creates a profile row linked to the school. (6) Supabase sends a verification email. (7) Student clicks the link and logs in. (8) The app generates an E2EE keypair &mdash; private key stays in IndexedDB, public key gets uploaded to the server.</p>

<p><strong>Postconditions:</strong> Student has an auth record, a profile, a school association, and a published public key ready for encrypted messaging.</p>

<h3>Use Case 3: Create Group Conversation</h3>
<p>Group chats work a lot like DMs but with more members and an admin role. The student taps the "+" button, picks "Group," and searches for classmates. The directory only shows students from the same school thanks to Row-Level Security &mdash; Supabase (2024) handles this at the database level so the app code does not need to filter manually. After selecting two or more people, the student creates the group. The system inserts a conversation record, adds each person as a member, and the conversation shows up in everyone's list through a Realtime subscription.</p>

<p class="no-indent"><span class="figure-label">Figure 5</span></p>
<p class="figure-caption">Workflow: Creating a Group Conversation</p>
<pre>
  STUDENT                                        SUPABASE
  -------                                        --------

  +--------------+
  | Tap "+" on   |
  | Messages page|
  +------+-------+
         |
         v
  +--------------+
  | Choose mode: |
  | DM or GROUP  |
  +------+-------+
         | Group
         v
  +--------------+       +--------------+
  | Search and   +------>| Query school |
  | browse       |<------| directory    |
  | students     |       | (same school |
  +--------------+       | only via RLS)|
         |               +--------------+
         v
  +--------------+
  | Select 2+    |
  | members      |
  +------+-------+
         |
         v
  +--------------+       +----------------------------------+
  | Tap "Create  +------>| INSERT conversations             |
  | Group (N)"   |       |   type: 'group'                  |
  +--------------+       |   created_by: student            |
                         +----------------------------------+
                         | INSERT conversation_members      |
                         |   creator  --> role: 'admin'     |
                         |   member 1 --> role: 'member'    |
                         |   member 2 --> role: 'member'    |
                         +--------------+-------------------+
                                        |
                                        v
                         +----------------------------------+
                         | Group appears in ALL members'    |
                         | conversation lists via Realtime  |
                         | Ready for encrypted messaging    |
                         +----------------------------------+
</pre>

<h3>Use Case 4: Share Encrypted File</h3>
<p>File sharing was one of the trickier parts to get right because you cannot just NaCl Box a whole file for each recipient &mdash; that would mean uploading the file N times for N members. Instead, the app generates a random symmetric key with NaCl Secretbox, encrypts the file once with that key, then wraps the symmetric key individually for each recipient using their public key. Bernstein et al. (2012) describe this as a hybrid encryption approach. The encrypted blob goes to Supabase Storage, and the wrapped keys get stored alongside the message. Each recipient unwraps their copy of the symmetric key, downloads the blob, and decrypts locally.</p>

<p class="no-indent"><span class="figure-label">Figure 6</span></p>
<p class="figure-caption">Workflow: Encrypted File Sharing With Hybrid Key Wrapping</p>
<pre>
  STUDENT (Sender)             ENCRYPTION ENGINE              SUPABASE
  ----------------             -----------------              --------

  +---------------+
  | Tap paperclip |
  | Select file   |
  +-------+-------+
          |
          |            +--------------------------+
          +----------->| 1. Read file into memory |
          |            +----------+---------------+
          |                       |
          |                       v
          |            +--------------------------+
          |            | 2. Generate RANDOM        |
          |            |    symmetric key          |
          |            |    (NaCl Secretbox)       |
          |            +----------+---------------+
          |                       |
          |                       v
          |            +--------------------------+
          |            | 3. ENCRYPT file with     |
          |            |    symmetric key         |
          |            +----------+---------------+
          |                       |
          |                       v
          |            +--------------------------+
          |            | 4. For EACH member:      |         +-------------+
          |            |    WRAP symmetric key    +-------->| Upload blob |
          |            |    with their public key |         | to Storage  |
          |            |    (NaCl Box)            |         +------+------+
          |            |                          |                |
          |            |    Member A: wrapped_key |                v
          |            |    Member B: wrapped_key |         +-------------+
          |            +--------------------------+         | Save msg    |
          |                                                | with file   |
          |                                                | URL + all   |
          |                                                | wrapped keys|
          |                                                +-------------+
          |
          |                  RECIPIENT FLOW:
          |            +--------------------------+
          |            | 1. Download encrypted    |
          |            |    blob from Storage     |
          |            | 2. UNWRAP symmetric key  |
          |            |    with own private key  |
          |            | 3. DECRYPT file with     |
          |            |    symmetric key         |
          |            | 4. Display / download    |
          |            +--------------------------+
</pre>

<h1>Main Screen Visual Design</h1>

<h2>Design System</h2>
<p>I went with a dark theme because most messaging apps have moved in that direction, and it is easier on the eyes for long reading sessions. The background is near-black (#0a0a0a) with lighter card surfaces (#1a1a1a) and gold accents (#cfb87c) pulled from CTU's branding. Body text uses DM Sans, headings use Instrument Serif, and anything encryption-related (like key fingerprints) uses JetBrains Mono so it is clearly distinguishable. Babich (2019) emphasizes that mobile-first design should prioritize thumb-reachable tap targets and minimal chrome, which is why the main actions (new chat, send message) are always within easy reach.</p>

<h2>Mobile Conversation List</h2>
<p class="no-indent"><span class="figure-label">Figure 7</span></p>
<p class="figure-caption">Mobile Wireframe: Conversation List (Main Screen)</p>
<pre>
  +--------------------------------------+
  |  Campus Connect       [CTU Online]   |  Navbar
  |         Messages  Directory  (gear)  |
  +--------------------------------------+
  |  Messages                      [+]  |  Header
  +--------------------------------------+
  |                                      |
  |  [JD]  Jane Doe             2:30p   |
  |        (lock) Encrypted message  *2 |  Conversation Card
  | - - - - - - - - - - - - - - - - - - |
  |  [SG]  Study Group           1:15p  |
  |        (lock) Encrypted message     |
  | - - - - - - - - - - - - - - - - - - |
  |  [AB]  Alex Brown           11:00a  |
  |        (lock) Encrypted message     |
  | - - - - - - - - - - - - - - - - - - |
  |  [CS]  CS 101 Group          Yest.  |
  |        (lock) Encrypted message     |
  +--------------------------------------+
</pre>

<h2>Mobile Chat View</h2>
<p class="no-indent"><span class="figure-label">Figure 8</span></p>
<p class="figure-caption">Mobile Wireframe: Chat Interface With Typing Indicator</p>
<pre>
  +--------------------------------------+
  |  &lt;- Jane Doe            [+Add][Files]|  Header
  +--------------------------------------+
  |                                      |
  |         Wednesday, Feb 26            |
  |                                      |
  |  +---------------------+             |  Incoming message
  |  | Hey, are you in     |             |  (left-aligned)
  |  | Prof. Smith's class?|             |
  |  +---------------------+             |
  |   Jane - 2:15 PM                     |
  |                                      |
  |            +---------------------+   |  Own message
  |            | Yeah! Section 2.    |   |  (right-aligned)
  |            | Want to study       |   |
  |            | together?           |   |
  |            +---------------------+   |
  |                   2:16 PM - Read     |
  |                                      |
  |   Jane is typing  ...               |
  +--------------------------------------+
  | (emoji)(GIF)(clip)| Type a msg | >> |  Input
  +--------------------------------------+
</pre>

<h2>Desktop Split Panel</h2>
<p>On wider screens (768px and up), the layout shifts to a split panel with the conversation list on the left and the active chat on the right. This follows the master-detail pattern that users already know from apps like iMessage and Slack.</p>

<p class="no-indent"><span class="figure-label">Figure 9</span></p>
<p class="figure-caption">Desktop Wireframe: Split-Panel Layout With Sidebar</p>
<pre>
  +---------------------------------------------------------------------+
  |  Campus Connect      CTU Online       Messages  Directory  (gear)   |
  +-----------------------+---------------------------------------------+
  |                       |                                             |
  | Messages        [+]  |  &lt;- Jane Doe                  [+Add][Files] |
  |- - - - - - - - - - - | - - - - - - - - - - - - - - - - - - - - - -|
  |                       |                                             |
  | [JD] Jane Doe  2:30p |         Wednesday, Feb 26                   |
  |   (lock) Encryp.  *2 |                                             |
  |                       |  +------------------+                       |
  | [SG] Study Grp 1:15p |  | Hey, are you in  |                      |
  |   (lock) Encrypted    |  | Prof. Smith's?   |                      |
  |                       |  +------------------+                       |
  | [AB] Alex B.  11:00a |   Jane - 2:15 PM                           |
  |   (lock) Encrypted    |                                             |
  |                       |           +------------------+              |
  | [CS] CS 101    Yest.  |           | Yeah! Section 2. |              |
  |   (lock) Encrypted    |           | Want to study    |              |
  |                       |           | together?        |              |
  |                       |           +------------------+              |
  |                       |                  2:16 PM - Read             |
  |                       |                                             |
  |                       |   Jane is typing  ...                      |
  |                       | +-------------------------------------+    |
  |                       | | (emoji)(GIF)(clip)| Type msg   | >> |    |
  |                       | +-------------------------------------+    |
  +-----------------------+---------------------------------------------+
</pre>

<h1>Data Management Requirements</h1>

<h2>Entity-Relationship Model</h2>
<p>The database has seven tables. The central one is profiles, which links to auth.users (Supabase's built-in auth table) on one side and schools on the other. Every conversation goes through the conversation_members junction table, which also tracks roles and read timestamps. Elmasri and Navathe (2015) stress that "referential integrity constraints are essential for maintaining consistency in relational databases" (p. 78), so I set up foreign keys with ON DELETE CASCADE throughout &mdash; if a user gets deleted, their memberships and messages go with them automatically.</p>

<p class="no-indent"><span class="figure-label">Figure 10</span></p>
<p class="figure-caption">Entity-Relationship Diagram for the CampusConnect Database</p>
<pre>
  +----------------+                              +----------------+
  |  auth.users    |                              |    schools     |
  |----------------|                              |----------------|
  | PK id          |                              | PK id          |
  |    email       |                              |    domain      |
  |    password    |                              |    name        |
  |    metadata    |                              |    logo_url    |
  +-------+--------+                              +-------+--------+
          | 1:1                                           | 1:many
          |                                               |
          v                                               v
  +---------------------------------------------------------------+
  |                        profiles                                |
  |---------------------------------------------------------------|
  | PK id --> auth.users    FK school_id --> schools               |
  |    email    display_name    avatar_url    phone_number         |
  |    preferred_language       is_verified   created_at           |
  +----+------------+------------------+----------------+----------+
       | 1:many     | 1:1              | 1:many         | 1:many
       v            v                  v                v
  +----------+ +----------+  +--------------+  +----------+
  |push_     | |public_   |  |conversation_ |  |messages  |
  |tokens    | |keys      |  |members       |  |          |
  |----------| |----------|  |--------------|  |----------|
  |PK id     | |PK user_id|  |PK conv_id    |  |PK id     |
  |FK user_id| |  pub_key |  |PK user_id    |  |FK conv_id|
  |   token  | |          |  |   role        |  |FK sender |
  |   device | +----------+  |   joined_at   |  |  content |
  +----------+               |   last_read   |  |  type    |
                             +------+--------+  |  file_url|
                                    | many:1    +----+-----+
                                    |                | many:1
                                    v                v
                             +----------------------------+
                             |       conversations        |
                             |----------------------------|
                             | PK id                      |
                             |    type ('dm' | 'group')   |
                             |    name                    |
                             | FK school_id --> schools    |
                             | FK created_by --> profiles  |
                             |    created_at, updated_at   |
                             +----------------------------+
</pre>

<h2>Row-Level Security</h2>
<p>Every table has RLS enabled, which means PostgreSQL itself checks whether the current user is allowed to read or write each row. This is not application-level filtering &mdash; it happens at the database engine level, so even a direct API call cannot bypass it (Supabase, 2024). I wrote a helper function called get_my_conv_ids() that returns the list of conversation IDs the current user belongs to, and most policies reference it.</p>

<p class="no-indent"><span class="figure-label">Table 3</span></p>
<p class="figure-caption">Row-Level Security Access Control Matrix</p>
<table>
  <thead>
    <tr><th>Table</th><th>SELECT</th><th>INSERT</th><th>UPDATE</th></tr>
  </thead>
  <tbody>
    <tr><td>schools</td><td>Everyone</td><td>System only</td><td>N/A</td></tr>
    <tr><td>profiles</td><td>Everyone</td><td>System only</td><td>Own row only</td></tr>
    <tr><td>conversations</td><td>Members only</td><td>Creator</td><td>Members only</td></tr>
    <tr><td>conversation_members</td><td>Members only</td><td>Authenticated</td><td>Own row only</td></tr>
    <tr><td>messages</td><td>Members only</td><td>Sender + Member</td><td>Members only</td></tr>
    <tr><td>public_keys</td><td>Authenticated</td><td>Own row only</td><td>Own row only</td></tr>
    <tr><td>push_tokens</td><td>Own row only</td><td>Own row only</td><td>Own row only</td></tr>
  </tbody>
</table>
<p class="table-note">Note. "Members only" means the user must appear in conversation_members for that conversation, enforced by the get_my_conv_ids() function.</p>

<h2>Encryption at Rest</h2>
<p>One thing I want to be clear about is what is encrypted and what is not. Message content and files are always encrypted before leaving the browser. Metadata like timestamps, sender IDs, and conversation membership is not encrypted &mdash; the server needs that information to route messages and enforce RLS. Table 4 breaks this down.</p>

<p class="no-indent"><span class="figure-label">Table 4</span></p>
<p class="figure-caption">Data Storage and Encryption Methods</p>
<table>
  <thead>
    <tr><th>Data Type</th><th>Where It Lives</th><th>How It Is Protected</th></tr>
  </thead>
  <tbody>
    <tr><td>Message text</td><td>messages.content (database)</td><td>NaCl Box &mdash; encrypted per recipient</td></tr>
    <tr><td>File contents</td><td>Supabase Storage (S3)</td><td>NaCl Secretbox &mdash; random symmetric key</td></tr>
    <tr><td>File keys</td><td>messages.content (database)</td><td>NaCl Box &mdash; wrapped per recipient</td></tr>
    <tr><td>Private keys</td><td>Browser IndexedDB (local)</td><td>Never leaves the device</td></tr>
    <tr><td>Public keys</td><td>public_keys table (database)</td><td>Plaintext &mdash; public by design</td></tr>
    <tr><td>Passwords</td><td>auth.users (database)</td><td>bcrypt hash &mdash; managed by Supabase Auth</td></tr>
  </tbody>
</table>

<h2>Data Flow Summary</h2>
<p class="no-indent"><span class="figure-label">Figure 11</span></p>
<p class="figure-caption">End-to-End Data Flow From Sender to Recipient</p>
<pre>
  +----------+     +------------+     +------------+     +----------+
  | Student  |     |   Client   |     |  Supabase  |     | Student  |
  | (Sender) |     |  (Crypto)  |     |  (Server)  |     | (Reader) |
  +----+-----+     +-----+------+     +-----+------+     +----+-----+
       |                  |                  |                  |
       |  Type message    |                  |                  |
       +----------------->|                  |                  |
       |                  |  Encrypt with    |                  |
       |                  |  recipient's     |                  |
       |                  |  public key      |                  |
       |                  |                  |                  |
       |                  |  Store encrypted |                  |
       |                  +----------------->|                  |
       |                  |                  |                  |
       |                  |                  |  Push via        |
       |                  |                  |  Realtime        |
       |                  |                  +----------------->|
       |                  |                  |                  |
       |                  |                  |         Decrypt  |
       |                  |                  |         with own |
       |                  |                  |         private  |
       |                  |                  |         key      |
       |                  |                  |                  |
       |                  |                  |         Display  |
       |                  |                  |<-----------------+
       |                  |                  |   Mark as read   |
       |  See "Read"      |                  |                  |
       |<-----------------+<-----------------+                  |
       |                  |  Realtime update |                  |
       v                  v                  v                  v
</pre>

<h2>Storage Considerations</h2>
<p>Messages are loaded with pagination (50 at a time) so the app does not try to decrypt an entire conversation history on load. Foreign keys with CASCADE handle cleanup automatically. The conversation_members table uses a composite primary key on (conversation_id, user_id) for fast membership lookups, and the get_my_conv_ids() helper caches its result per database request so it does not re-evaluate for every row in a policy check.</p>

<!-- REFERENCES -->
<div class="page-break"></div>
<h1>References</h1>
<div class="references">
<p>Babich, N. (2019). <em>Mobile UI design: Best practices and guidelines</em>. Smashing Magazine. https://www.smashingmagazine.com/2018/02/guide-user-experience-design-mobile/</p>

<p>Bass, L., Clements, P., &amp; Kazman, R. (2012). <em>Software architecture in practice</em> (3rd ed.). Addison-Wesley Professional.</p>

<p>Bernstein, D. J., Lange, T., &amp; Schwabe, P. (2012). The security impact of a new cryptographic library. In A. Hevia &amp; G. Neven (Eds.), <em>Progress in cryptology &ndash; LATINCRYPT 2012</em> (pp. 159&ndash;176). Springer. https://doi.org/10.1007/978-3-642-33481-8_9</p>

<p>Elmasri, R., &amp; Navathe, S. B. (2015). <em>Fundamentals of database systems</em> (7th ed.). Pearson.</p>

<p>Ermoshina, K., Musiani, F., &amp; Halpin, H. (2016). End-to-end encrypted messaging protocols: An overview. In F. Bagnoli et al. (Eds.), <em>Internet science</em> (pp. 244&ndash;254). Springer. https://doi.org/10.1007/978-3-319-45982-0_22</p>

<p>Sommerville, I. (2015). <em>Software engineering</em> (10th ed.). Pearson Education.</p>

<p>Supabase. (2024). <em>Supabase documentation: Row level security</em>. https://supabase.com/docs/guides/auth/row-level-security</p>
</div>

</body>
</html>
